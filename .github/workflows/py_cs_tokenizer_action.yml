name: python cs tokenizer

on:
  push:
    branches: main
    paths:
      - 'PythonCSharpener/FineLocalizer/**.cs'

jobs:
  build-on:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2

    - name: docker
      run: |
        cd ./PythonCSharpener/localization_tool
        mkdir out
        docker-compose up -d
   
    - name: get tokens from cs and write to xlsx
      if: hashFiles('./PythonCSharpener/localization_tool/CoPick.Logging.xlsx') != ''
      run: |
        docker exec xl2resx_container python3 ./localization_tool/CSharpener.py ./FineLocalizer ./localization_tool/CoPick.Logging.xlsx
        
    - name: make the resources of FineLocalizer
      if: hashFiles('./PythonCSharpener/localization_tool/CoPick.Logging.xlsx') != ''
      run: |
        docker exec xl2resx_container python3 ./localization_tool/xl2resx.py ./localization_tool/CoPick.Logging.xlsx
        sudo mv ./PythonCSharpener/localization_tool/out/*.resx ./PythonCSharpener/FineLocalizer/Lang/

    - name: commit
      run: |
        git config --local user.email "dev@cogaplex.com"
        git config --local user.name "CoPickDev[bot]"
        git add .
        git status
        git commit -m "Updates localization changes"

    - name: push
      uses: ad-m/github-push-action@master
      with:
        github_token: ${{ secrets.GITHUB_TOKEN }}
        branch: ${{ github.ref }}
